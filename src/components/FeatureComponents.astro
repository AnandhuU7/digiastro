---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

const feature: CollectionEntry<"feature">[] = await getCollection("feature");

// Add SEO metadata
const title = "Hikvision Security Solutions | Premium Security Technology";
const description = "Professional Hikvision security solutions featuring expert installation, 24/7 support, and comprehensive warranty coverage. Access cutting-edge surveillance technology at competitive prices.";
const canonicalURL = "https://dubai-hikvision.com";

// Generate dynamic SEO keywords and descriptions based on features
const featureKeywords = feature.map(f => f.data.name).join(", ");
const featureDescriptions = feature.map(f => f.data.body).join(" ");
const seoKeywords = `Hikvision, Security Solutions, ${featureKeywords}, Surveillance, CCTV, Access Control`;
const seoDescription = `${description} ${featureDescriptions}`;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Hikvision Security Solutions",
  "description": seoDescription,
  "brand": { "@type": "Brand", "name": "Hikvision" },
  "image": "https://dubai-hikvision.com/logo.svg",
  "additionalProperty": [
    {
      "@type": "PropertyValue",
      "name": "Installation",
      "value": "Professional setup by certified technicians"
    },
    ...feature.map(f => ({
      "@type": "PropertyValue",
      "name": f.data.name,
      "value": f.data.body
    }))
  ]
}
---

<!-- Add SEO meta tags -->
<head>
  <title>{title}</title>

  <meta name="description" content={seoDescription} />
  <meta name="keywords" content={seoKeywords} />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href={canonicalURL} />
  
  <!-- Open Graph / Social Media Meta Tags -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={seoDescription} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:image" content="https://dubai-hikvision.com/logo.svg" />
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={seoDescription} />
  <meta name="twitter:image" content="https://dubai-hikvision.com/logo.svg" />
  
<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
</head>


<section class="relative">
  <div class="container relative pt-10" style="background-color: #f1f7ff;">
    <div class="grid grid-cols-1 pb-5 text-center">
      <span class="bg-cyan-50 text-cyan-600 text-sm font-medium px-4 py-1 rounded-full mb-4 inline-block mx-auto">
        Premium Security Solutions
      </span>
      
      <h2 class="font-bold text-3xl md:text-4xl text-slate-900 leading-tight mb-6">
        Hikvision Technology
        <span class="text-cyan-600 block mt-2">Securing Your Future</span>
      </h2>
      
      <p class="text-slate-600 text-base md:text-lg max-w-3xl mx-auto leading-relaxed px-4 md:px-0">
        We provide great pricing on all Hikvision products, so you can get your hands on top-notch security technology without breaking the bank. With us, you'll find the best bang for your buck, all while ensuring you don't skimp on quality or performance. Our extensive selection features state-of-the-art surveillance cameras, smart security systems, and cutting-edge access control solutions.
      </p>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-8 max-w-4xl mx-auto text-left px-8">
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-cyan-500 max-w-xs mx-auto sm:mx-0 w-full">
          <h3 class="font-semibold text-slate-900 mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Expert Installation
          </h3>
          <p class="text-slate-600">Professional setup and configuration by certified technicians</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-cyan-500 max-w-xs mx-auto sm:mx-0 w-full">
          <h3 class="font-semibold text-slate-900 mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            24/7 Support
          </h3>
          <p class="text-slate-600">Round-the-clock technical assistance and monitoring</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 border-l-4 border-cyan-500 max-w-xs mx-auto sm:mx-0 w-full">
          <h3 class="font-semibold text-slate-900 mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Warranty Coverage
          </h3>
          <p class="text-slate-600">Comprehensive warranty and maintenance plans</p>
        </div>
      </div>  
      <div class="mt-10">
        <a href="/productsnew" class="inline-flex items-center justify-center px-8 py-3 text-base font-medium text-white bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 rounded-lg transition duration-300 ease-in-out transform hover:-translate-y-1 shadow-lg hover:shadow-xl">
          Explore Products
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </a>
      </div>
    </div>
  </div>
  <div class="relative" style="background-color: #f1f7ff;">
    <!-- Feature Cards Section with flip-flop for all screen sizes -->
    <div class="grid lg:grid-cols-4 md:grid-cols-2 sm:grid-cols-2 grid-cols-1 gap-6 pt-6 p-2 pb-4 mobile-feature-carousel" style="background-color: #f1f7ff;">
      {feature.map((feature, index) => (
        <div 
          class="group perspective h-[400px] w-full cursor-pointer feature-card" 
          data-index={index}
        >
          <div class="relative preserve-3d duration-1000 ease-in-out h-full w-full">
            <div class="absolute w-full h-full backface-hidden">
              <div class="rounded-xl shadow-lg hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300 relative bg-gradient-to-br from-[#e5edf7] to-[#e5edf7] p-8 overflow-hidden h-full border border-slate-700/50">
                <div class="flex items-center justify-center size-24 text-white text-center rounded-full p-4 bg-gradient-to-r from-cyan-600 to-cyan-500 group-hover:from-cyan-500 group-hover:to-cyan-400 transition-colors duration-500 shadow-lg">
                  <p class="font-bold">{feature.data.name}</p>
                </div>
                <div class="content mt-8 relative z-10">
                  <a href="/productsnew" class="title text-xl font-bold text-black hover:text-cyan-600 transition-colors duration-300 block mb-4">
                    {feature.data.title}
                  </a>
                  <p class="text-gray-700 leading-relaxed text-justify text-sm font-['Poppins',_sans-serif]">{feature.data.body}</p>
                </div>
              </div>
            </div>
            <div class="absolute inset-0 h-full w-full [transform:rotateY(180deg)] backface-hidden">
              <div class="rounded-xl shadow-lg transform transition-all duration-300 relative bg-gradient-to-br from-[#e5edf7] to-[#e5edf7] p-8 overflow-hidden h-full border border-slate-700/50">
                <div class="flex flex-col items-center justify-center h-full text-black">
                  <h3 class="text-2xl font-bold mb-4">{feature.data.name}</h3>
                  <p class="text-gray-700 text-center text-sm font-['Poppins',_sans-serif]">{feature.data.body}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- Mobile Navigation Buttons -->
    <div class="mobile-navigation-buttons flex justify-center items-center mt-6 md:hidden">
      <button id="prevButton" class="bg-white text-gray-700 flex items-center justify-center rounded-xl shadow-md hover:shadow-lg transition-all duration-300 w-11 h-11 mr-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="#06adcc" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <div class="carousel-indicators flex space-x-2">
        {feature.map((_, index) => (
          <div class="carousel-indicator w-2 h-2 rounded-full bg-gray-300 transition-colors duration-300" data-index={index}></div>
        ))}
      </div>
      <button id="nextButton" class="bg-white text-gray-700 flex items-center justify-center rounded-xl shadow-md hover:shadow-lg transition-all duration-300 w-11 h-11 ml-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="#06adcc" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</section>

<style>
  .perspective { perspective: 1000px; }
  .preserve-3d { transform-style: preserve-3d; }
  .backface-hidden { backface-visibility: hidden; }
  .flip { transform: rotateY(180deg); }
  
  /* Active indicator styling */
  .carousel-indicator.active {
    background-color: #06adcc;
    width: 0.75rem;
  }
  
  /* Hide all cards except the current one on mobile */
  @media (max-width: 767px) {
    .feature-card {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .feature-card.active {
      display: block;
      opacity: 1;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Get all feature cards and navigation elements
    const cards = document.querySelectorAll('.feature-card');
    const indicators = document.querySelectorAll('.carousel-indicator');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const totalCards = cards.length;
    let currentCardIndex = 0;
    
    // Function to toggle card visibility on mobile
    const updateCardVisibility = () => {
      if (window.innerWidth <= 767) {
        // First hide all cards
        cards.forEach((card, index) => {
          card.classList.remove('active');
        });
        
        // Show only the current card
        cards[currentCardIndex].classList.add('active');
        
        // Update indicators
        indicators.forEach((indicator, index) => {
          if (index === currentCardIndex) {
            indicator.classList.add('active');
          } else {
            indicator.classList.remove('active');
          }
        });
      } else {
        cards.forEach(card => {
          card.classList.add('active');
        });
      }
    };
    
    if (window.innerWidth <= 767) {
      cards[0].classList.add('active');
      indicators[0].classList.add('active');
    } else {
      cards.forEach(card => {
        card.classList.add('active');
      });
    }
    cards.forEach(card => {
      card.addEventListener('click', (e) => {
        const targetElement = e.target as Element;
        if (targetElement && targetElement.closest('button') === null) {
          const relativeElement = card.querySelector('.relative');
          if (relativeElement) {
            relativeElement.classList.toggle('flip');
          }
        }
      });
    });
    
    // Navigation for mobile
    if (prevButton) {
      prevButton.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent card flipping when clicking navigation
        currentCardIndex = (currentCardIndex - 1 + totalCards) % totalCards;
        updateCardVisibility();
      });
    }
    
    if (nextButton) {
      nextButton.addEventListener('click', (e) => {
        e.stopPropagation(); 
        currentCardIndex = (currentCardIndex + 1) % totalCards;
        updateCardVisibility();
      });
    }
    

    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', (e) => {
        e.stopPropagation(); 
        currentCardIndex = index;
        updateCardVisibility();
      });
    });
    
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    document.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    
    function handleSwipe() {
      if (window.innerWidth <= 767) {
        const swipeThreshold = 50;
        if (touchEndX < touchStartX - swipeThreshold) {
          currentCardIndex = (currentCardIndex + 1) % totalCards;
          updateCardVisibility();
        } else if (touchEndX > touchStartX + swipeThreshold) {
          currentCardIndex = (currentCardIndex - 1 + totalCards) % totalCards;
          updateCardVisibility();
        }
      }
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      updateCardVisibility();
    });
  });
</script>
---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import SlugProductDetails from "../../components/SlugProductDetails.astro";


export async function getStaticPaths() {
    const productEntries = await getCollection("accesscontrol");
  return productEntries.map((product) => ({
    params: { slug: product.slug },
    props: { product },
  }));
}

const { product } = Astro.props;
const ogUrl = `https://dubai-hikvision.com/accesscontrol/${product.slug}`;

const structuredData = {
    "@context": "https://schema.org",
    "@type": "Product",
    name: product.data.title,
    description: product.data.subTitle,
    image: [
        ...(product.data.thumbnails
            ? product.data.thumbnails.map((thumb) => {
                const fileName = thumb?.src?.split('/').pop()?.split('.')[0] || '';
                return {
                    "@type": "ImageObject",
                    contentUrl: "https://dubai-hikvision.com" + thumb.src,
                    width: 800,
                    height: 800,
                    creditText: fileName,
                    representativeOfPage: thumb.src === product.data.imgCard.src,
                };
            })
            : []),
    ],
    offers: {
        "@type": "Offer",
        priceCurrency: "AED",
        price: "0.00",
        availability: "https://schema.org/InStock",
        itemCondition: "https://schema.org/NewCondition"
    },
    aggregateRating: product.data.rating && product.data.reviewCount
        ? {
            "@type": "AggregateRating",
            ratingValue: Number(product.data.rating),
            reviewCount: Math.round(Number(product.data.reviewCount)),
            bestRating: 5,
            worstRating: 1,
        }
        : undefined,
    breadcrumbList: {
        "@type": "BreadcrumbList",
        itemListElement: [
            {
                "@type": "ListItem",
                position: 1,
                name: "Home",
                item: "https://dubai-hikvision.com"
            },
            {
                "@type": "ListItem",
                position: 2,
                name: "Products",
                item: "https://dubai-hikvision.com/productsnew"
            },
            {
                "@type": "ListItem",
                position: 3,
                name: "Access Control",
                item: "https://dubai-hikvision.com/accesscontrol"
            },
            {
                "@type": "ListItem",
                position: 4,
                name: product.data.title,
                item: `https://dubai-hikvision.com/accesscontrol/${product.slug}`
            }
        ]
    }
};
---

<Layout 
  title={product.data.title} 
  description={product.data.subTitle}
  ogUrl={ogUrl}
  lovosis={structuredData}
>
  <SlugProductDetails product={product} />
</Layout>
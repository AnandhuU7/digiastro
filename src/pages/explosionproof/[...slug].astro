---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import SlugProductDetails from "../../components/SlugProductDetails.astro";

// Fetch all product entries and generate static paths
export async function getStaticPaths() {
  const productEntries = await getCollection("explosionproof");
  return productEntries.map((product) => ({
    params: { slug: product.slug },
    props: { product },
  }));
}

// Access the product data passed via props
const { product } = Astro.props;

// Generate structured data for the product
const structuredData = {
  "@context": "https://schema.org",
  "@type": "Product",
  "name": product.data.title,
  "description": product.data.subTitle,
  "title": `${product.data.title} | Dubai Hikvision`,
  "url": `https://dubai-hikvision.com/explosionproof/${product.slug}`,
  "category": "explosionproof",
  "image": {
    "@type": "ImageObject",
    "url": `https://dubai-hikvision.com${product.data.imgCard.src}`,
    "width": 300, 
    "height": 300,
    "caption": `${product.data.title} - Hikvision Explosion Proof Camera`
  },
  "brand": {
    "@type": "Brand",
    "name": "Hikvision",
  },
  "offers": {
    "@type": "Offer",
    "price": 50,
    "priceCurrency": "AED",
    "availability": "https://schema.org/InStock",
    "itemCondition": "https://schema.org/NewCondition",
    "seller": {
      "@type": "Organization",
      "name": "Dubai Hikvision",
      "url": "https://dubai-hikvision.com",
      "logo": "https://dubai-hikvision.com/logo.svg"
    }
  },
  "aggregateRating": product.data.rating && product.data.reviewCount ? {
    "@type": "AggregateRating",
    "ratingValue": product.data.rating.toFixed(1),
    "reviewCount": product.data.reviewCount,
    "bestRating": "5",
    "worstRating": "1"
  } : undefined,
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https://dubai-hikvision.com",
          "name": "Home"
        }
      },
      {
        "@type": "ListItem",
        "position": 2,
        "item": {
          "@id": "https://dubai-hikvision.com/productsnew",
          "name": "Products"
        }
      },
      {
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https://dubai-hikvision.com/explosionproof",
          "name": "Explosion Proof Camera"
        }
      },
      {
        "@type": "ListItem",
        "position": 4,
        "item": {
          "@id": `https://dubai-hikvision.com/explosionproof/${product.slug}`,
          "name": product.data.title
        }
      }
    ]
  }
};

---

<Layout 
  title={structuredData.title} 
  description={structuredData.description}
  structuredData={structuredData}
>
  <SlugProductDetails product={product} />
</Layout>